<!-- Full integrated HTML+JS for Cash App with admin/user system, account creation, PIN/password reset, multi-segment UI -->
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Cash App</title>
<style>
/* Basic reset */
* { margin:0; padding:0; box-sizing:border-box; font-family:Arial; }
body {
  background: linear-gradient(135deg, #ff0000, #008000);
  min-height:100vh;
  padding:20px;
  color:#fff;
}
#titleBar {
  text-align:center;
  font-size:32px;
  font-weight:bold;
  margin-bottom:20px;
  text-shadow:2px 2px #000;
}
#mainContainer {
  display:flex;
  gap:15px;
  width:100%;
  min-height:80vh;
}
.segment {
  flex:1;
  background:rgba(255,255,255,0.1);
  border-radius:12px;
  padding:15px;
  backdrop-filter: blur(4px);
  overflow-y:auto;
  box-shadow:0 0 10px rgba(0,0,0,0.3);
}
button {
  padding:10px;
  border:none;
  border-radius:6px;
  cursor:pointer;
  margin-top:10px;
  font-weight:bold;
}
.inputBox {
  width:100%;
  padding:8px;
  margin-top:8px;
  border-radius:6px;
  border:none;
}
.accountItem {
  background:rgba(0,0,0,0.2);
  padding:10px;
  border-radius:6px;
  margin-top:10px;
  cursor:pointer;
}
.transaction {
  margin-top:8px;
  padding:8px;
  border-radius:6px;
  background:rgba(0,0,0,0.3);
}
</style>
</head>
<body>
<div id="titleBar">Cash App</div>

<div id="welcomeScreen">
  <h2>Welcome</h2>
  <button id="adminBtn" style="background:#3498db; color:#fff;">Admin</button>
  <button id="userBtn" style="background:#2ecc71; color:#fff;">User</button>
</div>

<div id="adminLogin" style="display:none;">
  <h3>Admin Login</h3>
  <input id="adminPassInput" type="password" class="inputBox" placeholder="Enter admin password" />
  <button id="adminLoginBtn" style="background:#3498db; color:#fff;">Login</button>
</div>

<div id="userSelect" style="display:none;">
  <h3>Select your account</h3>
  <div id="userAccountList"></div>
</div>

<div id="userPinScreen" style="display:none;">
  <h3>Enter your PIN</h3>
  <input id="userPinInput" type="password" maxlength="4" class="inputBox" />
  <button id="userPinBtn" style="background:#2ecc71; color:#fff;">Login</button>
</div>

<div id="appScreen" style="display:none;">
  <div id="mainContainer">

    <!-- Segment 1: Accounts list + admin functions -->
    <div class="segment" id="segment1">
      <h3>Accounts</h3>
      <div id="accountList"></div>

      <div id="adminControls" style="display:none; margin-top:20px;">
        <h3>Admin Controls</h3>
        <input id="accFullName" class="inputBox" placeholder="Full name" />
        <input id="accAlias" class="inputBox" placeholder="Alias" />
        <input id="accAge" class="inputBox" placeholder="Age" />
        <input id="accGender" class="inputBox" placeholder="Gender" />
        <input id="accPin" class="inputBox" placeholder="4-digit PIN" maxlength="4" />
        <button id="createAccBtn" style="background:#2980b9; color:#fff;">Create Account</button>

        <button id="deleteAccBtn" style="background:#e74c3c; color:#fff;">Delete Selected Account</button>
        <button id="resetUserPinBtn" style="background:#f1c40f; color:#000;">Reset User PIN</button>
        <button id="resetAdminPassBtn" style="background:#9b59b6; color:#fff;">Reset Admin Password</button>
      </div>
    </div>

    <!-- Segment 2: Account details -->
    <div class="segment" id="segment2">
      <h3>Account Details</h3>
      <div id="userRealName" style="font-size:18px; margin-bottom:10px;"></div>
      <div>Total Money: <span id="totalMoney">0</span></div>
      <input id="amountInput" class="inputBox" placeholder="Amount" type="number" />
      <input id="reasonInput" class="inputBox" placeholder="Reason/Comment" />
      <button id="addMoneyBtn" style="background:#2ecc71; color:#fff;">Add Money</button>
      <button id="removeMoneyBtn" style="background:#e74c3c; color:#fff;">Remove Money</button>
    </div>

    <!-- Segment 3: Transaction history -->
    <div class="segment" id="segment3">
      <h3>Transaction History</h3>
      <div id="historyList"></div>
    </div>

    <!-- Segment 4 -->
    <div class="segment" style="background:rgba(255,255,255,0.2);">
      <h3>More</h3>
      <p>Extra space for future features</p>
    </div>
  </div>
</div>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
<script>
// ---------------- Firebase ----------------
const firebaseConfig = {
  apiKey: "AIzaSyDbW2RuOnSr4H7Cl0_CLu99ckPbrh2y4Gw",
  authDomain: "business-app-data.firebaseapp.com",
  databaseURL: "https://business-app-data-default-rtdb.firebaseio.com",
  projectId: "business-app-data",
  storageBucket: "business-app-data.firebasestorage.app",
  messagingSenderId: "64963134720",
  appId: "1:64963134720:web:f8dd72fbe82342b1f91fe5",
  measurementId: "G-21K1R3V7SH"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// App state
let currentMode = ""; // admin or user
let currentAccount = "";
let cachedAccounts = {};

// Elements
const welcomeScreen = document.getElementById("welcomeScreen");
const adminLogin = document.getElementById("adminLogin");
const userSelect = document.getElementById("userSelect");
const userPinScreen = document.getElementById("userPinScreen");
const appScreen = document.getElementById("appScreen");
const adminControls = document.getElementById("adminControls");

// ---------------- Welcome Buttons ----------------
document.getElementById("adminBtn").onclick = ()=>{
  currentMode="admin";
  welcomeScreen.style.display="none";
  adminLogin.style.display="block";
};

document.getElementById("userBtn").onclick = ()=>{
  currentMode="user";
  welcomeScreen.style.display="none";
  userSelect.style.display="block";
  loadUserAccountList();
};

// ---------------- Admin Login ----------------
document.getElementById("adminLoginBtn").onclick = async ()=>{
  const pass = document.getElementById("adminPassInput").value;
  const snap = await db.ref("admin/password").once("value");
  if(!snap.exists()){
    await db.ref("admin/password").set(pass);
    alert("Admin password created!");
  }
  const real = snap.val();
  if(pass===real){
    adminLogin.style.display="none";
    appScreen.style.display="block";
    adminControls.style.display="block";
    loadAccountList();
  } else alert("Wrong password");
};

// ---------------- User Select ----------------
async function loadUserAccountList(){
  const snap = await db.ref("accounts").once("value");
  document.getElementById("userAccountList").innerHTML="";
  snap.forEach(acc=>{
    const a = acc.val();
    const div = document.createElement("div");
    div.className="accountItem";
    div.innerText = a.alias;
    div.onclick = ()=>{
      currentAccount = acc.key;
      userSelect.style.display="none";
      userPinScreen.style.display="block";
    };
    document.getElementById("userAccountList").appendChild(div);
  });
}

// ---------------- User PIN Login ----------------
document.getElementById("userPinBtn").onclick = async ()=>{
  const pin = document.getElementById("userPinInput").value;
  const snap = await db.ref("accounts/"+currentAccount+"/pin").once("value");
  if(pin===snap.val()){
    userPinScreen.style.display="none";
    appScreen.style.display="block";
    adminControls.style.display="none";
    setupUserView();
  } else alert("Wrong PIN");
};

function setupUserView(){
  loadAccountList();
  document.getElementById("addMoneyBtn").style.display="none";
  document.getElementById("removeMoneyBtn").style.display="none";
  loadAccountDetails();
}

// ---------------- Load Accounts for admin panels ----------------
async function loadAccountList(){
  const snap = await db.ref("accounts").once("value");
  cachedAccounts = snap.val() || {};
  const list = document.getElementById("accountList");
  list.innerHTML="";
  for(let id in cachedAccounts){
    const a = cachedAccounts[id];
    const div = document.createElement("div");
    div.className="accountItem";
    div.innerText = a.alias;
    div.onclick = ()=>{
      currentAccount = id;
      loadAccountDetails();
    }
    list.appendChild(div);
  }
}

// ---------------- Load Account Details ----------------
async function loadAccountDetails(){
  const snap = await db.ref("accounts/"+currentAccount).once("value");
  const a = snap.val();
  document.getElementById("userRealName").innerText = a.fullname;
  document.getElementById("totalMoney").innerText = a.balance || 0;
  loadHistory();
}

// ---------------- History ----------------
async function loadHistory(){
  const snap = await db.ref("accounts/"+currentAccount+"/history").once("value");
  const list = document.getElementById("historyList");
  list.innerHTML="";
  snap.forEach(h=>{
    const t = h.val();
    const div = document.createElement("div");
    div.className="transaction";
    div.style.color = t.type === "add" ? "#0f0" : "#ff4444";
    div.innerText = `${t.type.toUpperCase()}: ${t.amount} - ${t.reason}`;
    list.appendChild(div);
  });
}

// ---------------- Add / Remove Money ----------------
document.getElementById("addMoneyBtn").onclick = ()=> changeMoney("add");
document.getElementById("removeMoneyBtn").onclick = ()=> changeMoney("remove");

async function changeMoney(type){
  const amt = parseInt(document.getElementById("amountInput").value);
  const rsn = document.getElementById("reasonInput").value;
  if(!amt || !rsn) return alert("Enter amount + reason");
  const snap = await db.ref("accounts/"+currentAccount+"/balance").once("value");
  let bal = snap.val() || 0;
  bal = type==="add" ? bal+amt : bal-amt;
  await db.ref("accounts/"+currentAccount+"/balance").set(bal);
  const newHist = db.ref("accounts/"+currentAccount+"/history").push();
  await newHist.set({type, amount:amt, reason:rsn});
  loadAccountDetails();
}

// ---------------- Create Account ----------------
document.getElementById("createAccBtn").onclick = async ()=>{
  const fn = document.getElementById("accFullName").value;
  const al = document.getElementById("accAlias").value;
  const ag = document.getElementById("accAge").value;
  const gd = document.getElementById("accGender").value;
  const pn = document.getElementById("accPin").value;
  if(!fn || !al || !pn) return alert("Fill full name, alias, PIN");
  const id = db.ref("accounts").push();
  await id.set({fullname:fn, alias:al, age:ag, gender:gd, pin:pn, balance:0});
  loadAccountList();
}

// ---------------- Delete Account ----------------
document.getElementById("deleteAccBtn").onclick = async ()=>{
  if(!currentAccount) return alert("Select an account");
  await db.ref("accounts/"+currentAccount).remove();
  currentAccount="";
  loadAccountList();
}

// ---------------- Reset User PIN ----------------
document.getElementById("resetUserPinBtn").onclick = async ()=>{
  if(!currentAccount) return alert("Select an account first");
  const newPin = prompt("Enter new 4-digit PIN:");
  if(!newPin || newPin.length!==4) return alert("PIN must be 4 digits");
  await db.ref("accounts/"+currentAccount+"/pin").set(newPin);
  alert("PIN reset successfully!");
}

// ---------------- Reset Admin Password ----------------
document.getElementById("resetAdminPassBtn").onclick = async ()=>{
  const newPass = prompt("Enter new admin password:");
  if(!newPass) return;
  await db.ref("admin/password").set(newPass);
  alert("Admin password updated!");
}
</script>

<!-- BEGIN: Admin + User Account System Enhancements Will Be Inserted Here -->
<!-- (Workingâ€¦ full upgraded code will be progressively inserted and expanded here by Nora.) -->
<!-- END -->
</body>
</html>
